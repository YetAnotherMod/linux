/*
 * Device Tree Source for RCM 1888TX018 platform
 *
 * Copyright Â© 2019 Alexey Spirkov <dev@alsp.net>
 *
 * This file is licensed under the terms of the GNU General Public
 * License version 2.  This program is licensed "as is" without
 * any warranty of any kind, whether express or implied.
 */

/include/ "1888tx018.dtsi"

/ {
	model = "rcm,1888tx018";
	compatible = "rcm,1888tx018";

	aliases {
		serial0 = &uart0;
		serial1 = &uart1;
		serial2 = &uart2;
		mmc0 = &mmc0;
	};

	// HDMI channel 0 for DRM drivers
	hdmi-out0 {
		status = "disabled";
		compatible = "hdmi-connector";
		type = "a";

		port {
			hdmi_con0: endpoint {
				remote-endpoint = <&adv7513_0_out>;
			};
		};
	};

	// HDMI channel 1 for DRM drivers
	hdmi-out1 {
		status = "disabled";
		compatible = "hdmi-connector";
		type = "a";

		port {
			hdmi_con1: endpoint {
				remote-endpoint = <&adv7513_1_out>;
			};
		};
	};

	plb {

		sram_nor_arbiter {
			status = "ok";
			sram-nor-mux = <1>; // 0 to route extmem wires to LSIF0, 1 - to MCIF
			// in case of LSIF0 following lines will be needed
			ext-mem-mux-mode = <0>; // 0 - SRAN_NOR, 1 - NAND GBIT_GRETH0 GBIT_GRETH1, 2 - GRETH0 GRETH1 NAND
			mii-mux-mode = <1>; // 0- GBIT_GRETH1, 1 - GRETH2
			ce-manage = <2>; // 0
			pinctrl-names = "default";
			pinctrl-0 =
				/* GRETH_GBIT1 -> GMII */
				<&lsif0_mgpio9_greth_gbit1_gmii>,
				<&lsif0_mgpio10_greth_gbit1_gmii>;
				
		};

		lsif0 {
			greth_gbit1: greth_gbit1@0x3C034000 {
				status = "ok";
				mac-address = [ EC 17 66 77 05 02 ];
			};
		};

		lsif1 {
			i2c0: i2c@0x3C05A000 {
				status = "ok";

				// HDMI channel 0 for fbdev and v4l2 drivers
				adv7513_0: adv7513@39 {
					status = "okay";
					reg = <0x39>;
				};

				// HDMI channel 1 for fbdev and v4l2 drivers
				adv7513_1: adv7513@3d {
					status = "okay";
					reg = <0x3D>;
				};

				hdmi@39 {
					status = "disabled";
					compatible = "adi,adv7513";
					reg = <0x39>, <0x29>, <0x49>, <0x59>;
					reg-names = "main", "cec", "edid", "packet";

					adi,input-depth = <8>;
					adi,input-colorspace = "yuv444";
					adi,input-clock = "1x";
					adi,input-style = <1>;
					adi,input-justification = "evenly";

					ports {
						#address-cells = <1>;
						#size-cells = <0>;

						port@0 {
							reg = <0>;
							adv7513_0_in: endpoint {
								remote-endpoint = <&vdu_out_rgb0>;
							};
						};

						port@1 {
							reg = <1>;
							adv7513_0_out: endpoint {
								remote-endpoint = <&hdmi_con0>;
							};
						};
					};
				};

				// HDMI channel 1 for DRM drivers
				hdmi@3d {
					status = "disabled";
					compatible = "adi,adv7513";
					reg = <0x3d>, <0x2d>, <0x4d>, <0x5d>;
					reg-names = "main", "cec", "edid", "packet";

					adi,input-depth = <8>;
					adi,input-colorspace = "yuv444";
					adi,input-clock = "1x";
					adi,input-style = <1>;
					adi,input-justification = "evenly";

					ports {
						#address-cells = <1>;
						#size-cells = <0>;

						port@0 {
							reg = <0>;
							adv7513_1_in: endpoint {
								remote-endpoint = <&vdu_out_rgb1>;
							};
						};

						port@1 {
							reg = <1>;
							adv7513_1_out: endpoint {
								remote-endpoint = <&hdmi_con1>;
							};
						};
					};
				};
			};

			uart0: uart0@3C05D000 {
				status = "ok";
			};

			uart1: uart2@3C05E000 {
				status = "ok";
			};

			uart2: uart3@3C05F000 {
				status = "ok";
			};

			spi0: spi@0x3C061000 {
				status = "ok";
				num-cs = <1>;
				cs-gpios = <&gpio1 2 0>;

				spi_flash@0 {
					compatible = "st,m25p32", "spi-nor";
					reg = <0>;
					spi-max-frequency = <20000000>;
				};
			};

			mmc0: mmc0@0x3C064000 {
				status = "ok";
				max-frequency = <25000000>;
				cd-gpios = <&gpio1 1 0>; // card detect
			};

			gpio0: gpio0@0x3C065000 {
				status = "ok";
			};

			gpio1: gpio1@0x3C066000 {
				status = "ok";
			};

			usb_otg_hs: usb_otg_hs@0x3C06D000 {
				status = "ok";
				mode = <1>; // 1 - host, 2 - device
			};
		};

		hsif {
			rmace: rmace@0x3C024000 {
				status = "ok";
				dma-channel-count = <1>;
			};
		};

		mms {
			// VPU for kernel V4L2 driver
			vpu_v4l2: vpu@38020000 {
				status = "ok";
			};

			jpg: jpg@0x3801a000 {
				status = "ok";
			};

			i2s: i2s@0x39080000 {
				status = "ok";
			};

			i2s0: i2s@0 {
				status = "ok";
			};

			spdif: spdif@0x39080000 {
				status = "ok";
			};

			audio_dma: audio_dma@0x38017000 {
				status = "ok";
			};

			spdif_out: spdif-out {
				#sound-dai-cells = <0>;
				compatible = "linux,spdif-dit";
			};

			audio_dma: audio_dma@0x38017000 {
				status = "ok";
			};

			// HDMI channel 0 for fbdev and v4l2 drivers (actually VDU index 1)
			vdu0: vdu@0x38013000 {
				status = "ok";
			};

			// HDMI channel 1 for fbdev and v4l2 drivers (actually VDU index 0)
			vdu1: vdu@0x38011000 {
				status = "ok";
			};

			// HDMI channel 0 for DRM drivers (actually VDU index 1)
			vdu0_drm: vdu@38013000 {
				status = "disabled";
				output-color-space = "yuv444";
				max-width = <1280>;
				max-height = <720>;
				ports {
					port@0 {
						vdu_out_rgb1: endpoint@1 {
							remote-endpoint = <&adv7513_1_in>;
						};
					};
				};
			};

			// HDMI channel 1 for DRM drivers (actually VDU index 0)
			vdu1_drm: vdu@38011000 {
				status = "disabled";
				output-color-space = "yuv444";
				max-width = <1280>;
				max-height = <720>;
				ports {
					port@0 {
						vdu_out_rgb0: endpoint@0 {
							remote-endpoint = <&adv7513_0_in>;
						};
					};
				};
			};

			sound {
				status = "ok";
				compatible = "simple-audio-card";
				simple-audio-card,name = "RCM Audio";
				#address-cells = <1>;
				#size-cells = <0>;
				#sound-dai-cells = <0>;

				simple-audio-card,dai-link@0 { // I2S0 - cs4344
					reg = <0>;
					format = "i2s";
					compatible = "cirrus,cs4344";
					frame-master = <&cpu_dai>;
					bitclock-master = <&cpu_dai>;

					widgets =
						"Line", "Line Out";

					routing =
						"Line Out", "LLOUT",
						"Line Out", "RLOUT";

					cpu_dai: cpu {
						sound-dai = <&i2s0>;
						dai-tdm-slot-num = <2>;
						dai-tdm-slot-width = <32>;
					};

					codec {
						sound-dai = <&codec_dummy>;
					};

				};

				simple-audio-card,dai-link@4 { // spdif
					reg = <4>;
					cpu {
						sound-dai = <&spdif>;
					};
					codec {
						sound-dai = <&spdif_out>;
					};
				};

			};

			codec_dummy: codec_dummy {
				compatible = "linux,snd-soc-dummy";
				#sound-dai-cells = <0>;
				status = "okay";
			};

		};

		apb0 {

			watchdog: watchdog@0x38002000 {
				status = "ok";
			};

			thermal: thermal@0x38003000 {
				status = "ok";
			};

			cpufreq: cpufreq@0x38006000 {
				status = "ok";
				      // freq      fb pre post div
				freqs = <200000     32  1   2    0>,
				        <400000     32  1   1    0>,
				        <800000     64  1   1    0>;

			};
		};

		xhsif0 {
			pcie0: pcie@1010000000 {
				status = "ok";
			};
		};

		xhsif1 {
			pcie1: pcie@1018000000 {
				status = "ok";
			};
		};

		dspcores {
			nmc3_0_core0: nmc3_0_core0@0x39000000 {
				status = "ok";
				core-name = "K1879-nmc";
			};
			nmc3_0_core1: nmc3_0_core1@0x39020000 {
				status = "ok";
				core-name = "K1879-nmc";
			};
			nmc3_1_core0: nmc3_1_core0@0x39040000 {
				status = "ok";
				core-name = "K1879-nmc";
			};
			nmc3_1_core1: nmc3_1_core1@0x39060000 {
				status = "ok";
				core-name = "K1879-nmc";
			};
		};
	};

	thermal-zones {
		cpu-thermal {
			polling-delay-passive = <0>;
			polling-delay =  <1000>;
			thermal-sensors = <&thermal>;

			trips {
				cpu-crit {
					temperature = <100000>;
					hysteresis = <0>;
					type = "critical";
				};
			};

			cooling-maps {
			};
		};
	};

	chosen {
		stdout-path = &uart0;
	};
};
